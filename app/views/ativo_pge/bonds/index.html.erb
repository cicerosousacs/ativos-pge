<h1 class="h3 mb-2 text-gray-800"><%= t('views.bond.title', model: @bonds.model_name.human(count: 2)) %></h1>
<div class="card shadow mb-3">
  <div class="card-header py-3">
    <div>
      <%= link_to new_ativo_pge_bond_path do %>
        <button class="btn btn-success"><%= t('button.new', model: @bonds.model_name.human) %></button>
      <% end %>
      <button type="button" id="btn-termo" class="btn btn-info"><%= t('button.new_term') %></button>
    </div>
    <%= search_form_for @q, url: ativo_pge_bonds_path, method: :get,  class:"form-inline" do |f| %>
    <div class="form-inline col-md-6">
      <%= f.select :user_id_eq, options_from_collection_for_select(@users, "id", "name"), {include_blank: 'Pesquisa por usuÃ¡rio'}, class:"form-control" %>
    </div>
    <div class="form-inline col-md-5">
      <%= f.select :attach_ativo_ativo_id_eq, options_from_collection_for_select(@assets, "id", "tombo"), {include_blank: 'Pesquisa por tombo'}, class:"form-control" %>
    </div>
    <div class="form-inline">
      <%= button_tag type:'submit', class:"btn btn-success" do %>
        <i class="fas fa-search fa-sm"></i>
      <% end %>
    </div>
    <% end %>
  </div>
  <div class="card-body">
    <table class="table table-hover table-bordered">
      <thead>
        <tr>
          <th style="width: 10px">
            <input type="checkbox" id="all_bonds" title="Selecione um vinculo para gerar o Termo"></input>
          </th>
          <th><%= translate_attribute(@bonds, :area) %></th>
          <th><%= translate_attribute(@bonds, :subarea_id) %></th>
          <th><%= translate_attribute(@bonds, :user_id) %></th>
          <th><%= translate_attribute(@bonds, :note) %></th>
          <th><%= t('views.bond.modality') %></th>
          <th colspan="4" class="text-center"><%= t('action.shares') %></th>
        </tr>
      </thead>
      <tbody>
        <% if @bonds.blank? %>
          <tr>
            <td colspan="7" class="text-center text-info"><%= t('views.bond.not_found') %></td>
          </tr>
        <% else %>
          <% @bonds.each do |bond| %>
            <tr>
              <td><%= check_box_tag("bonds_ids[]", bond.id, false, class:'marcar') %></td>
              <td width="25%"><%= bond.subarea.area.description %></td>
              <td width="25%"><%= bond.subarea.description %></td>
              <td width="20%"><%= bond.user.name %></td>
              <td width="20%"><%= bond.note %></td>
              <td width="30%"><%= bond.check_home_office %>
                <% if bond.homeoffice.present? %>
                  <%= link_to ativo_pge_bond_path(bond), remote: true, data: { target: '#bondmodal', toggle: 'modal' } do %>
                    <i title=<%= t('subtitle.term') %> class="fa-regular fa-file-pdf"></i>
                  <% end %>
                <% end %>
              <td style="width: 12px">
                <%= link_to ativo_pge_bond_path(bond), remote: true, data: { target: '#bondmodal', toggle: 'modal' } do %>
                  <i title=<%= t('subtitle.show') %> class="gray fa fa-eye"></i>
                <% end %>
              <td style="width: 12px">
                <%= link_to ativo_pge_history_path(bond), remote: true, data: { target: '#historymodal', toggle: 'modal' } do  %>
                  <i title=<%= t('subtitle.history') %>  class="orange fa fa-clock-rotate-left"></i>
                <% end %>
              <td style="width: 12px">
                <%= link_to edit_ativo_pge_bond_path(bond) do %>
                  <i title=<%= t('button.edit') %> class="blue fa fa-edit"></i>
                <% end %>
              <td style="width: 12px">
                <%= link_to ativo_pge_bond_path(bond), method: :delete, data: {confirm: t('message.confirm_bond', name: current_admin.name, item: bond.user.name) } do %>
                  <i title=<%= t('button.delete') %> class="red fa fa-trash" id="errorAlert"></i>
                <% end %>  
              </td>
            </tr>
          <% end %>
        <% end %>
      </tbody>
    </table>
    <div class="text-black-50 text-sm">Total de vinculos: <%= @total_bonds %></div>
  </div>
</div>
<%= paginate @bonds %>

<%= javascript_include_tag 'application' %>

<script>
  $(document).ready(function () {
    $('#btn-termo').click(function () {
      var bonds_ids = $('.marcar:checked').map(function () {
      return $(this).val();
      }).get();
      if (bonds_ids == '') {
        alert('Selecione pelo menos um vinculo');
      } else {
        if (this.id == 'btn-termo') {
          window.open('<%= url_for({ :controller => 'bonds', :action => 'term_responsibility_asset' })%>?bonds_ids=' + bonds_ids);
          $('.marcar, #all_bonds').prop("checked", false);
        }
      }
    });
    
    $("#all_bonds").change(function () {
      $('.marcar').prop('checked', $(this).prop("checked"));
    });
        
    $("#all_bonds").click(function(){
      $('.marcar').not(this).prop('checked', this.checked);
    });
        
    var all_bonds = $("#all_bonds");
    all_bonds.click(function () {
      if ( $(this).is(':checked') ){
        $('.marcar').prop("checked", true);
      }else{
        $('.marcar').prop("checked", false);
      }
    });
  });

  $(document).ready(function(){
    $(".user_name").select2({
      theme: 'bootstrap'
    });
  });
</script>
